---
layout: post
title: "7年前的文章7年前的自己"
date: 2014-05-07 21:31
comments: true
categories: life
---

{% blockquote %}
7年前临近毕业时王老师让我写的一篇文章。从网上搜索了下来重新放在这里以作留念。7年来，当初那个无知的喜欢瞎折腾的对一切事物充满好奇的傻瓜一直未曾改变。（文章标题是当时王老师发在他博客中时添加的）
{% endblockquote %}
<h2 align="center">一个机械系学生学习嵌入式开发的经历</h2>

真是不好意思写，搞的我跟个高手似的。

原本是打算在毕业的时候写，然后发在无限飞翔上的。那样也比较合理啊，毕业了总得留点什么给学弟学妹们吧。可现在又还没到毕业的时候，自己又没什么成绩，说写个文章给大家看，心里总感觉怪怪的！就当我是提前写了。毕业的时候我还想整理出几个文档，到时候再补上。

第一次听说单片机是在大一的时候，当时还买了一本51的书看。中间断断续续的看了两三年，什么也没看出来。等到能看懂书上的LED闪烁的例子的时候已经是大三下学期了，这个时候我还不知道单片机长啥模样呢。后来想照着书上的电路做个真的东西出来，可是手头上什么也没有啊！于是就上网查。结果我被弄得晕头转向，什么仿真器、开发板、编程器，我不知道到底该买什么哪个，就这样我又迷糊了将近半年。

真正让我明白要买什么的是一篇叫作《虾米是怎样炼成的》的文章。于是我就在淘宝上买了个编程器、两块AT89S52和两个晶振。等到这些东西到来的时候正好是大四上学期开学。接着我又到数电实验室找老师买了面包板和一些电阻电容之类的小元件。

三天之后我的第一个流水灯程序，终于跑起来了。我又打电话叫钟建金来看，我们一直看着它在那闪啊闪……高兴得我一夜没睡。

接着我还做了个数码管动态显示的时钟，最后又做了个AT89C2051+18B20+162A的温度计，这些都是在面包板上搭的。这时候已离开学过去了一个月了。我一直是用两根电线从电脑机箱里面接出来的电源，弄得电脑经常死机（大家试试就知道了）。我的程序都是在记事本里写的，然后用一个DOS下的编译器编译的。那时我还不知道KEIL可以写汇编啊，哈哈，见笑了……

后来就想做板子。我想做个时钟摆在桌子上拽一下啊。于是又上网查，说是买个敷铜板,然后用铅笔画出线路，再用胶布把线路粘好，腐蚀一下就行。于是我又在淘宝上买了两块单面的敷铜板。板子一到我就开始用铅笔在板子上画线路，可是6个数码管连在一起的线路我死活都画不出来啊。没办法，只好学Protel了，听说它能自动布线。学了之后。才知道单面板布6个数码管的线路还是很困难，于是我决定先做个简单的电路板试试。经过两三个星期的折腾。我的第一块板子终于做出来了，是用MAX232做的一个串口电平转换电路，高兴得我又是一夜没睡。那几天上课我都把做好的小板子带在身上，见到同学就拿出来给他们看。他们问我是怎么弄的，我就开始给他们讲“就个嘛……”，后来才知道RXD和TXD搞反了！

做板子的这期间遇到的困难算是最多了。集成库的问题让我郁闷了一个多星期，到处发帖子求助也没人理我。为了买到盐酸和双氧水，我几乎尝试了所有办法，先是在淘宝上搜，没搜到。又到药店里去找，浓度又太低。我又在网上搜十堰哪有卖化学品的商店，抄下了一堆电话号码，然后一个个的打，打了一下午，结果全都是卖化妆品的，差点晕了！结果偶然在一个相关的论坛上看到了一个东风公司网友的签名，上面留有他的电话，我连忙给他打电话，于是他叫我到人民商场附近的一个卖电子器件的商店里去问一下，店老板又叫我到老虎沟去看看……就这样，最后总算买到了。

后来我知道了热转印法做板子。困难又是接踵而至。这其中的过程我就不多说了，直接把我的一些经验告诉大家吧。拿芯片在屏幕上比着，然后按printscreen键，这样的PCB图打印出来要比实际小。.没有热转印纸的话可以用蜡纸代替，然后用水浸泡再用手搓掉粘在上面的纸片就行了。图形要拿到党校那个小店里去打，因为在蜡纸上打印，机子老爱卡纸，街上的店不让打，打的话也特别贵。没有热转印机可以用电熨斗代替。指甲油可以代替抗氧化剂。焊锡丝要买发亮的，细一些的，不然很有可能买到的是保险丝，那样死活都焊不上。还有，不要在网上买30元一把的电钻，钻一个孔大概要一分钟……

接着我又用7805做了个小电源板，最后还做了一块简单的51实验板。把它们三个连在一起，就是一个完整的实验板了。这时，我开始尝试用KEIL写程序了，用printf( )写了个串口发送“HELLO WORLD！”的程序，让它运行了一下午。还写了个键盘扫描的程序，全用的SWITCH， CASE。后来我又照着书上的介绍，用RTX51TINY写了个简单的多任务程序，让P1.0上的LED隔1S闪一下，P1.1上的LED隔2S闪一下……我一下子就被这种编程方式吸引住了,连忙打印了一份RTX51的资料，通宵把它那完了。但不知道它的原理是什么啊，又到处查资料，就这样我知道了有UCOS这个东西，于是又想学这个。我找了好多UCOS在51上移植的版本，但都不能运行，郁闷了好几天。后来和其中一个版本的作者(杨屹)发EMAIL寻问是什么原因，他说是KEIL没有完全授权的原因。于是我又找了一个破解版的，果然一下子就运行起来了，高兴得我又是一夜没睡着。那些时候我每天回来都要运行几遍UCOS，生怕它跑不起来了，哈哈！

成天看着它运行，看多了也不爽啊，又不知道它的工作原理。我知道这个与操作系统的有关，于是在电驴上下载了吉大的操作系统视频教程，天天在宿舍看。作了很多笔记，其实到后来就感觉只听懂了个信号量。它举的用PV原语操作四个任务共享一台打印机的例子，感觉真的很巧妙。进程到底是个什么东西，到现在也没搞清楚，听说UCOS里面没有进程的概念。文件系统也听不懂……知道了操作系统的一些基本概念之后，我又在阅览室找到了邵贝贝翻译的UCOS（二楼没的借啊），天天晚上都在那看。粗略地看了一遍后，感觉很迷糊。真是差点放弃了，但一想，这么好的东西扔了多可惜啊，于是又坚持看，边看边作笔记，最后总算知道了UCOS的大概框架了，知道了每个文件是干什么的。

就这样，我开始决定分析UCOS源代码了。我把UCOS的代码全打印了。说实话,我当时都不知道这些是不是白打了，以前我也打印过VC++的好多资料，可到头来什么也没看。拿着这厚厚的一叠代码，我根本不知道从哪下手。

前几天我都是拿着这些代码坐在自习室发呆。天天睡觉的时候都在想，我到底该从哪里下手啊。偶尔想出了些线索，我就立马写在本子上，生怕明天早上起来又忘了。

最后总算想明白要怎么弄了。操作系统主要就是完成任务调度，我可以先看与完成任务调度的文件，暂时忽略信号量，消息队列，邮箱这几个文件，不去看它们。只看与CUP相关的三个文件(主要是OS_CPU_A.ASM)，还有OSCORE.C，OSTASK.C这两个文件。这样原先厚厚的一叠代码立马只剩下三分之一了，这下心里轻松了许多。我又把这剩下的这几个文件中的函数全都找出来，写在本子上，又把HOOK函数全都去掉，这样代码又减少了不少，心里又松了口气。我在图书馆找了一本C语言的书把指针和链表粗略地看了一下，就正式开始开始分析UCOS了。从MAIN()开始，看它到底是如何一步步执行的，先是OSInit()，在本子上查到它在OSCORE.C文件中，于是把它找出来，一步步的分析，看不明白的地方就去阅览室看邵贝贝的书……就这样，大约过了三四个星期之后吧，感觉51上UCOS的运行过程我已经是非常清晰了。

这期间也遇到过不少困难。一堆文件摆在桌子上，稍不留神就会头晕。有时想找出一个变量的出处，死活也找不到。不过到最后，看到一个陌生的变量就能大概猜到他在哪个文件中的哪个地方了，这也是最令人高兴的事了……

后来得知UCOS在ARM7上用的多，于是我又想学ARM。上网一查，我又傻眼了。和当初学51时情形一样，资料铺天盖地，不知道到底学哪个芯片好。想找个引脚少点的吧，LPC2XXX怎么样，心里又不敢确定……真正让我决定学哪块片子的又是在网上看到的一篇叫《嵌入式开发心得》的文章。于是我就决定了学44B0。

首先得准备板子啊。心想，有板子的话，就能学的快了，再也不像学51时的那样了，看了几年书什么都不知道。于是我上淘宝搜44B0，结果搜出来的全都是现成的开发板，可我只要想一块芯片啊，就像当初学51一样，板子可以自己弄啊。最后终于找到有一个卖44B0芯片的人了。我说我想买一块44B0。他问我买来干什么用，我说做个实验板啊。他说你不如直接买现成的板子好了，自己做的话，开板费都要好几百。我说我用热转印手工做啊！他说，你水平真高！！！……哈哈！！！

后来终于想通了，于是想买个现成的板子，可是钱已经用完了啊。经常在网上看着那些板子发呆，我当时看上了S3CEV40这块开发板。做梦都想有买它。可是S3CEV40要一千多块钱啊！我想，那就等毕业找工作挣钱了再买它吧。于是我只好先看关于ARM的一些基础教程了。就这样我花了几个星期把ARM的汇编指令看了两遍。做了很多笔记，还打印了很多资料。在这个过程中，我知道了RSIC和CSIC的区别，也体会到冯氏结构和哈佛结构在编程时的区别……

接下来就是来听王老师和陈老师的嵌入式讲座了。说来真是幸运！我当时正在上机电一体化的课，又刚好听到感兴趣的地方。当时邱老师在讲PID控制。我一直想搞清楚这个，今天又正好听得了一点门道。这时秀军给我发短信，叫我快点来听嵌入式讲座，说座位已经帮我占好了。我想来想去不知道舍掉哪个好啊。最后想PID的内容我还是晚上回宿舍再自己看看书吧，反正已经有了个开头了！嵌入式要是不听的话就没机会了！于是我就来听嵌入式讲座了。讲到中间的时候，王老师拿出了两块开发板给我们介绍。我一看那块不正好是44B0的吗。而且王老师还谈到了UCOS。听完讲座后，我没心思去自习了，赶紧回来想和王老师取得联系，于是我在电信系网站上找到了王老师的邮箱，发了一封邮件。就这样我认识了王老师……现在终于有机会在实验室玩44B0了。

我原以为44B0和51差不多。心想不也是个单片机吗，给相应的寄存器设置好，它就能跑起来了，不行的话，就上网找个程序改改再搬进去不就OK了。用了之后才知道它的困难。光个启动，就让我郁闷了很久，到现在我还不是很清楚。还有中断的问题，JTAG仿真的问题，IAR编译器的问题……

接触44B0也有些时候了，感觉至今还处于迷糊状态。不过还是有一些收获的。起码知道了一些关于JTAG的知识，今天晚上我又看了些JTAG的资料，真想知道仿真到底是个怎样的过程。对IAR环境也有些了解，这些时候一直在看这个，隐隐约约能感觉到编译的一些过程，也感觉到了他的复杂性，知道这里面还有大学问，这是我以前用KEIL时从来没有过的体会……

这些时候我每天都要到很晚才睡! 今天我又打印了IAR下编译生成的MAP文件，我是想看看XCL文件与它的对应关系。但看着看着头又晕了！唉……

真的能感到时间越来越紧张！就要放假了，而我还有太多的不懂，真想在放假之前把剩下来的问题都搞定，然后过年回家好好研究LINUX。

感觉现在的机会真是很难得，过去自己一个人在黑暗中摸索的情形，我真是怕了。现在终于能在实验室里做实验了，而且还有王老师指导。 王老师提供给我很多的资料，这些在网上是很难找到的。实验室什么条件都有，比起我以前弄的那些破烂玩意，不知道要强多少倍。看到实验室桌子上一大卷焊锡丝摆在那，我真的很羡慕。我当初找到一个修电脑的店里买焊锡丝，他要1块钱 1米，结果我只好买了 3米。在淘宝上叫人家送我几个小元件都要哀求半天。电子器材店里的数码管要3元一个……

我的经历就说这么多了。一路下来，跳来跳去，就感觉自己是猴子掰玉米。很早的时候就在网上听过别从的劝告：“成天把新技术挂在嘴边，不如把旧知识烂在心里”。可我就是忍不住啊！！！

今天早上舅舅打电话来问叫我放假到他那帮忙写个51的程序,我说没问题,肯定能搞定。其实心里还不是很有把握。到现在为止我连一份简历都没写过，我不知道写些什么，说我会这会那的，就感觉自己有些心慌……

现在真想再把高数、C语言、模电、数电好好学一遍。以前是不知道学这些有什么用，现在总算知道了。高数是学习DSP的基础。C语言就不说了，我想卫星上跑的应该是C语言吧。模电能很方便地实现很多算法，这是王 老师告诉我的。数电是学FPGA的基础……

这些我要是早点明白该多好啊！！！但话又说回来，如果不是自己这么折腾的话，我也不可能会明白这些。

这半年来我的视力狂降，在图书馆里找书的时候，就感觉眼睛很花。大一，大二的时候天天打CS，也不见视力下降，我还以为自己的视力是下降不了的……

就要毕业了，真的舍不得这个学校。出了社会，还会有谁教我啊，哪来这么多的书看啊,哪有这么好的条件啊……

还舍不得在学习过程中认识的这么多朋友。要不是秀军发短信叫我来听王老师的讲座，我恐怕现在还不知道44B0长啥模样。也是通过他，我才得以认识更多志同道合的朋友。我和秀军是在电子器材店里认识的，当时他和罗斌也在哪里找东西，我们于是就聊了起来，一聊就是个没完。还有王辉，总是看到他在图书馆自习，我们也经常在一起聊天。曾生伟和赵斐，是最近才认识的，你们的很热心我都记在心里了！

还有李鑫明，刚认识他的时候他老爱把“单片机”说成“单机片”，,呵呵！后来他问我学单片机该买些什么东西，我就说你把我的东西拿去用吧，反正放在那也是闲着。我还写了三个简单的例子给他，给他演示了一下操作过程，又帮他在书上划了一些记号。

感觉大家都是因为对同一个东西感兴趣才聚到了一起，真的很难得！要是早点认识你们这些朋友该多好啊！！！

现在，我已经想好了。在这剩下的半年里，要好好利用实验室的条件把ARM的基础知识搞清楚，毕业之后再花些时间把基础的知识好好补充一下。

现在就觉得51、ARM、UCOS、LINUX这些其实都是一些工具而已。这些学好了之后，然后还要选一个一辈子要好好研究的东西，我现在能想到的就只有网络和控制论了。

再看看现在的自己……唉！还是不多想了，一步步走吧！将来如果能够出点什么成绩的话，真是要谢天谢地了！